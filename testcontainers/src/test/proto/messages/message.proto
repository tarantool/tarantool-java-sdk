syntax = "proto3";

package tarantool.queue_ee;

option go_package = "gitlab.vkteam.ru/tarantool/tqe/message-queue.git/v2/server/protocol";

// Пара ключ-значение
message Pair {
  // Ключ пары
  string key = 1;

  // Значение пары
  string value = 2;
}

// Сообщение в очереди
message QueueMessage {
  // Идентификатор сообщения
  // Заполняется автоматически при записи сообщения в очередь
  uint64 id = 1;

  // Название очереди в которую необходимо опубликовать сообщение
  string queue = 2;

  // Ключ маршрутизации сообщения (тип сообщения)
  // необходим для фильтрации сообщений из очереди на консьюмерах
  optional string routing_key = 3;

  // Ключ шардирования
  // необходим для распределения данных в системе
  optional string sharding_key = 4;

  // Ключ дедупликации
  // необходим для проверки повторных сообщений,
  // если не указан, то проверка не производится
  optional string deduplication_key = 5;

  // Произвольные данные в бинарном формате, содержит тело сообщения
  bytes payload = 6;

  // Произвольные данные в бинарном формате,
  // содержит дополнительные для сообщения данные,
  // необходимые для отладки и трассировки
  map<string, string> metadata = 7 [deprecated = true];

  // Время вставки сообщения в очередь в наносекундах
  int64 timestamp = 8;

  // Произвольные данные в формате списка из пар ключ-значения
  repeated Pair metadata_pairs = 9;
}
